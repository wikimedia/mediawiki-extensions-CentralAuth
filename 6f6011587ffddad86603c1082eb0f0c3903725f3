{
  "comments": [
    {
      "key": {
        "uuid": "49c305cb_7626aed2",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 16
      },
      "writtenOn": "2013-07-13T21:14:35Z",
      "side": 1,
      "message": "Isn\u0027t the code at the top of SpecialCentralAutoLogin::execute supposed to handle this?",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49c305cb_161ada77",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 221
      },
      "writtenOn": "2013-07-13T21:35:23Z",
      "side": 1,
      "message": "It should for most cases. The hole is if the logged-into wiki doesn\u0027t have $wgCentralAuthLoginWiki while the remote wiki does, or vice versa.\n\nSay enwiki doesn\u0027t have $wgCentralAuthLoginWiki set while mediawikiwiki does. Someone logs in on enwiki, and since $wgCentralAuthLoginWiki isn\u0027t set there it doesn\u0027t do the redirect to loginwiki. Then when enwiki makes an iframe for mediawikiwiki, mediawikiwiki redirects over to loginwiki for the central query, which doesn\u0027t have any login, so it fails.\n\nConversely, if someone logs in on mediawikiwiki, it does the loginwiki redirect and then makes an iframe for enwiki. Since $wgCentralAuthLoginWiki isn\u0027t set on enwiki, it uses mediawikiwiki as its central wiki, but then mediawikiwiki rejects the query because it thinks the central query should have gone to loginwiki.\n\nIt seems that this patch is aimed at the latter situation.",
      "parentUuid": "49c305cb_7626aed2",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49c305cb_ffdd5112",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 204
      },
      "writtenOn": "2013-07-14T22:53:21Z",
      "side": 1,
      "message": "Correct, the 2nd case above is the one that is causing issues right now. People login to test2wiki, which opens an iframe to www.wikidata.org. wikidatawiki doesn\u0027t have $wgCentralAuthLoginWiki set, so it redirects back to test2wiki instead of loginwiki. So when people visit test.wikidata.org, they aren\u0027t logged in.\n\nThe first case above isn\u0027t too likely, since wiki which don\u0027t have $wgCentralAuthLoginWiki set should probably use the old-style auto login anyway. Unless there\u0027s a simple fix for that as well.",
      "parentUuid": "49c305cb_161ada77",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49c305cb_ea4d9174",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 16
      },
      "writtenOn": "2013-07-15T03:36:24Z",
      "side": 1,
      "message": "I was more curious whether it could be fixed in that same code block, but it probably doesn\u0027t matter.",
      "parentUuid": "49c305cb_ffdd5112",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49c305cb_85f20e97",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 221
      },
      "writtenOn": "2013-07-15T16:49:13Z",
      "side": 1,
      "message": "Well, we could add something like this above line 29\n\n     } elseif ( $request-\u003egetVal( \u0027from\u0027 ) \u003d\u003d\u003d wfWikiId() \u0026\u0026 $wgCentralAuthLoginWiki !\u003d\u003d wfWikiId() ) {\n         // Remote wiki must not have wgCentralAuthLoginWiki set, but we do. Redirect them.\n         $this-\u003edo302Redirect( $wgCentralAuthLoginWiki, $par, $_GET );",
      "parentUuid": "49c305cb_ea4d9174",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49c305cb_c57ec6e0",
        "filename": "specials/SpecialCentralAutoLogin.php",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 204
      },
      "writtenOn": "2013-07-15T17:11:41Z",
      "side": 1,
      "message": "I\u0027m fine either way. We just need to get a fix for this merged today.",
      "parentUuid": "49c305cb_85f20e97",
      "revId": "6f6011587ffddad86603c1082eb0f0c3903725f3",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}