{
  "comments": [
    {
      "key": {
        "uuid": "0ebaf39b_5f408138",
        "filename": "includes/CentralAuthUtils.php",
        "patchSetId": 6
      },
      "lineNbr": 135,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Does not match the argument name. (Not introduced in this patch, but since you are touching this method anyway...)",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_d0853b0c",
        "filename": "includes/CentralAuthUtils.php",
        "patchSetId": 6
      },
      "lineNbr": 135,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Done in the parent patch.",
      "parentUuid": "0ebaf39b_5f408138",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_44bc3401",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Why not take everything from $config? The current implementation falls back to globals anyway.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_f0895fef",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Because Config is silly. $config might only have core configuration settings, requiring ConfigFactory::getDefaultInstance()-\u003emakeConfig( \u0027CentralAuth\u0027 ) to get the Config object that has CentralAuth\u0027s configuration.\n\nIt\u0027ll work with the current default GlobalVarConfig, but not necessarily in the future.\n\nBlame Lego.",
      "parentUuid": "0ebaf39b_44bc3401",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_86d0e9fb",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T22:31:20Z",
      "side": 1,
      "message": "\u003e It\u0027ll work with the current default GlobalVarConfig, but not necessarily in the future.\n\nI would expect the globals to stop working as well in that future.\nAnyway, not really related to this patch, feel free to ignore.",
      "parentUuid": "0ebaf39b_f0895fef",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_641ff80d",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 78,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "I feel a bit uncomfortable about this. If in the future someone changes CookieSessionProvider::provideSessionInfo to call a function call that\u0027s overriden in this class, this will behave in an unpredictable way; and it\u0027s near impossible to catch such a bug in code review, since the change would be in core but the bug in CentralAuth.\nWould it be inconvenient to just use two separate providers, or have this provider wrap the other one and delegate to it, instead of relying on inheritance?\n\n----\n\nThe check in https://github.com/wikimedia/mediawiki-extensions-CentralAuth/blob/master/includes/CentralAuthHooks.php#L809 gets dropped here. I suppose it won\u0027t be missed, but maybe mention it in the summary?",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_507aabe7",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 78,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Composition is troublesome because we really do want to override setLoggedOutCookie() and sessionDataToExport() in the base class. \"Two session providers\" is troublesome because we can\u0027t change the provider responsible for the session based on which user gets passed to Session::setUser(), which we would need to to in order to support non-centralized users.\n\nSo if you insist, we\u0027d need a subclass of CookieSessionProvider that only overrides those two methods that is then composed into this class.\n\n----\n\n$this-\u003eenable on line 76 is that check. Or if you\u0027re talking about the renaming thing, that\u0027s now done by CentralAuthHooks::onSessionCheckInfo().",
      "parentUuid": "0ebaf39b_641ff80d",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_061ab9d0",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 78,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T22:31:20Z",
      "side": 1,
      "message": "Fair point, I didn\u0027t think the composition thing through. I guess the current setup is still the least evil.",
      "parentUuid": "0ebaf39b_507aabe7",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_7f6225d6",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Is this done to reset the expiration time of the central session? Maybe worth adding a comment about it, the code looks quite mysterious at first glance.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_0b688418",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "To reset the ID of the central session, actually. Comments added.",
      "parentUuid": "0ebaf39b_7f6225d6",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_6b1ee0bf",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 185,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "I need to not do this unconditionally, it only applies if we have an attached central user.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_0a6165a3",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 206,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "I believe it is done so that logging out on one site logs you out everywhere. That also requires unsetting/not setting the core Token cookie, I believe that is missing here.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_ab8378ab",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 206,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "The logging out on one site logs you out everywhere is done by $centralUser-\u003eresetAuthToken() in CentralAuthHooks::onUserLogout().\n\nGood call on the core Token cookie.",
      "parentUuid": "0ebaf39b_0a6165a3",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_aaf619f4",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 236,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "This needs to be done for each setCookie call separately.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_8b65540f",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 236,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0ebaf39b_aaf619f4",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_caf90de6",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 239,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Maybe add a comment that this sets it to the normal cookie expiry time (or just set it explicitly, like the old code did)? That\u0027s one super confusing aspect of the setCookie interface.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_6b56e02e",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 239,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0ebaf39b_caf90de6",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_2aea2905",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 242,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Was the P3P stuff dropped intentionally? If so, can you mention it in the commit message?",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_0b3964ef",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 242,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "No, fixed.",
      "parentUuid": "0ebaf39b_2aea2905",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_2ac1c982",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 253,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "This felt like a good time to improve the WebRequest::setCookie() interface -\u003e I0357c4a38085c4754bf6ff7e40756179d19b912d",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_6b04a01a",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 253,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0ebaf39b_2ac1c982",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_aa0a99d2",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 254,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "Is there a reason to use $this-\u003ecentralCookieOptions instead of $options here? That way an attacker might learn the user has logged in to the wiki recently, even if the wiki is HTTPS-only.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_45418e38",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 254,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T11:10:34Z",
      "side": 1,
      "message": "Um, it might not, of course, unless the user\u0027s clock is extremely out of date. Anyway, it\u0027s easier to read if the same variable is used everywhere, if there is no functional difference. I don\u0027t think httpOnly matters when deleting a cookie.",
      "parentUuid": "0ebaf39b_aa0a99d2",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_a60ded3a",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 254,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Because $options isn\u0027t defined in this code path.",
      "parentUuid": "0ebaf39b_aa0a99d2",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_cad02d56",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 264,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "I think this should be $expiry : null.\n\nAlso, doesn\u0027t matter much but using 1 for cookie value looked cleaner.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_c61b4171",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 264,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "This matches what core did and does for the cookie.\n\n$expiry isn\u0027t defined here.",
      "parentUuid": "0ebaf39b_cad02d56",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_6675b5f3",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 264,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T22:31:20Z",
      "side": 1,
      "message": "Uh, not sure where I got the expiry bit, that wouldn\u0027t make sense anyway. CentralAuth used \u00271\u0027 as value: https://github.com/wikimedia/mediawiki-extensions-CentralAuth/blob/master/includes/CentralAuthUser.php#L2430 but matching what core does is certainly better (and it is unlikely to make a difference anyway).",
      "parentUuid": "0ebaf39b_c61b4171",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_aacdb9bd",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 267,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "You could update the bug number format to Phabricator.",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_064dd975",
        "filename": "includes/session/CentralAuthSessionProvider.php",
        "patchSetId": 6
      },
      "lineNbr": 267,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0ebaf39b_aacdb9bd",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_0ac5e563",
        "filename": "includes/specials/SpecialCentralAutoLogin.php",
        "patchSetId": 6
      },
      "lineNbr": 72,
      "author": {
        "id": 389
      },
      "writtenOn": "2015-11-03T09:42:50Z",
      "side": 1,
      "message": "$type?",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ebaf39b_f0887f24",
        "filename": "includes/specials/SpecialCentralAutoLogin.php",
        "patchSetId": 6
      },
      "lineNbr": 72,
      "author": {
        "id": 221
      },
      "writtenOn": "2015-11-03T21:53:13Z",
      "side": 1,
      "message": "D\u0027oh.",
      "parentUuid": "0ebaf39b_0ac5e563",
      "revId": "bfde729f3ffa4b38f5760a2e375226ec15ef26c9",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}